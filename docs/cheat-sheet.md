# Cheat-Sheet

## Integrate with CMake

```CMake
find_package(FSeam)

# Create a executable/library target called binaryWithContentToTest with the code you want to test 

enable_testing()
addFSeamTests(
        DESTINATION_TARGET fseamTargetName
        TARGET_AS_SOURCE binaryWithContentToTest
        TST_SRC 
                ${CMAKE_CURRENT_SOURCE_DIR}/catch2TestFile.cpp #Testing source files
        TO_MOCK
                ${CMAKE_CURRENT_SOURCE_DIR}/src/DependencyToMock.hh #Give header to mock
)
```

Options:
* If using Google Test
```bash
cmake -DFSEAM_USE_GTEST=ON
```
* If using Catch2
```bash
cmake -DFSEAM_USE_CATCH2=ON
```

## Use into a test

Include to use:
```cpp
#include <FSeamMockData.hpp> // Contains the FSeam generated object to create FSeam Mock Handlers
```

### Get Mock from instance

```cpp
// Example taken from test folder
source::TestingClass testingClass {};
// Get the mock of the object returned by getDepGettable()
auto fseamMock = FSeam::get(&testingClass.getDepGettable()); 
```

### Get Default Mock

```cpp
// Example taken from test folder
// Get the default mock for the source::DependencyNonGettable mocked type
auto fseamDefaultMock = FSeam::getDefault<source::DependencyNonGettable>();
```

### Never forget to cleanup
FSeam is, under the hood, using singletons and statically allocated memory. In order to ensure the isolation of each test. You need to cleanup FSeam after each test with the help of the static method cleanUp (FSeam::MockVerifier::cleanUp()).

```cpp
TEST_CASE("...") {

    // ...

    SECTION("...") {
        // ...
    }
    
    FSeam::MockVerifier::cleanUp(); // Needed in order to ensure each test is correctly isolated
}
```

***

### Dupe Return Value

Method to use
```cpp
//FSeam::ClassMocked::methodOfClassMocked is an empty shell struct generated by FSeam to manipulate the named method
mock->dupeReturn<FSeam::ClassMocked::methodOfClassMocked>(ObjectToReturn);
```
Example : 
```cpp
source::TestingClass testingClass {};
auto fseamMock = FSeam::get(&testingClass.getDepGettable());

// Dupe the return value of the method checkSimpleReturnValue with 42
fseamMock->dupeReturn<FSeam::DependencyGettable::checkSimpleReturnValue>(42);
// now the method return 42
REQUIRE(42 == testClass.getDepGettable().checkSimpleReturnValue()); 
```

### Verify

**Usage of verify with**: FSeam::NeverCalled{}, FSeam::AtLeast{int}, FSeam::AtMost{int}, FSeam::VerifyCompare{int}

Method to use
```cpp
//FSeam::ClassMocked::methodOfClassMocked::NAME gives the name of the method into a string (generated by FSeam)
//Comparator is either : FSeam::NeverCalled{}, FSeam::AtLeast{int}, FSeam::AtMost{int}, FSeam::VerifyCompare{int}
verify(FSeam::ClassMocked::methodOfClassMocked::NAME, ObjectToReturn, Comparator);
```
Example : 
```cpp
#include <FSeamMockData.hpp> // Contains the FSeam mocking tools
using namespace FSeam;

source::TestingClass testingClass {};
auto fseamMock = FSeam::get(&testingClass.getDepGettable());

// Check checkSimpleInputVariable has never been called
REQUIRE(fseamMock->verify(FSeam::DependencyGettable::checkSimpleInputVariable::NAME, NeverCalled{1}));

testingClass.execute(); // this execute the method  checkSimpleInputVariable
testingClass.execute();
testingClass.execute(); // Executed 3 times

// Check checkSimpleInputVariable has been called at least once (both are equivalent)
REQUIRE(fseamMock->verify(FSeam::DependencyGettable::checkSimpleInputVariable::NAME));
REQUIRE(fseamMock->verify(FSeam::DependencyGettable::checkSimpleInputVariable::NAME, AtLeast{1}));

// Check checkSimpleInputVariable has been called exactly 3 times (both are equivalent)
REQUIRE(fseamMock->verify(FSeam::DependencyGettable::checkSimpleInputVariable::NAME, 3));
REQUIRE(fseamMock->verify(FSeam::DependencyGettable::checkSimpleInputVariable::NAME, VerifyCompare{3}));

// Check checkSimpleInputVariable has been called at most 3 times
REQUIRE(fseamMock->verify(FSeam::DependencyGettable::checkSimpleInputVariable::NAME, AtMost{3}));
```

### Argument expectation

**Expectation argument are done with**: FSeam::Any(), FSeam::Eq(obj), FSeam::NotEq(obj)  
An wildcard exist for FSeam::Any() which is _ (following google mock style).  
Method to use
```cpp
//FSeam::ClassMocked::methodOfClassMocked is an empty shell struct generated by FSeam to manipulate the named method
//ArgComparator is either : FSeam::Any{}, FSeam::Eq{Object}, FSeam::NotEq{Object}
//Comparator is either : FSeam::NeverCalled{}, FSeam::AtLeast{int}, FSeam::AtMost{int}, FSeam::VerifyCompare{int}
fseamMock->expectArg<FSeam::ClassMocked::methodOfClassMocked>(ArgComparator, ArgComparator, Comparator);
```
Example : 
```cpp
using namespace FSeam;
source::TestingClass testingClass {};
auto fseamMock = FSeam::get(&testingClass.getDepGettable());

// check method checkSimpleInputVariable has been called exactly 2 times with first arg 29 and second "dede"
fseamMock->expectArg<FSeam::DependencyGettable::checkSimpleInputVariable>(Eq(29), Eq(std::string("dede")), VerifyCompare{2});
// check method checkSimpleInputVariable has been called exactly 2 times with first arg 29 and second can be anything
fseamMock->expectArg<FSeam::DependencyGettable::checkSimpleInputVariable>(Eq(29), Any(), VerifyCompare{2});
// Same with the usage of the wildcard
fseamMock->expectArg<FSeam::DependencyGettable::checkSimpleInputVariable>(Eq(29), _, VerifyCompare{2});
// check method checkSimpleInputVariable has been called exactly 2 times with first arg not equal 29 and second not equal "dede"
fseamMock->expectArg<FSeam::DependencyGettable::checkSimpleInputVariable>(NotEq(29), NotEq(std::string("dede")), AtLeast{2});
// match our first expecation, but not the second
testClass.getDepGettable().checkSimpleInputVariable(29, "dede"); 
testClass.getDepGettable().checkSimpleInputVariable(29, "dede");
// has both not equal to expectation, this is not a match to our first expectation, but does the second
testClass.getDepGettable().checkSimpleInputVariable(29, "dddd"); 
testClass.getDepGettable().checkSimpleInputVariable(42, "dede");

// verify need to be called in order to check expectations
REQUIRE(fseamMock->verify(FSeam::DependencyGettable::checkSimpleInputVariable::NAME));
```
